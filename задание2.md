## Задание 2

### Сконфигурируйте файловое хранилище

- При помощи трех дополнительных дисков, размером 1Гб каждый, на HQ-SRV сконфигурируйте дисковый массив уровня 5

- Имя устройства - md0, конфигурация массива размещается в файле /etc/mdadm.conf

- Обеспечьте автоматическое монтирование в папку /raid5

- Создайте раздел, отформатируйте раздел, в качестве файловой системы используйте ext4

- Настройте сервер сетевой файловой системы (nfs), в качестве папки общего доступа выберите /raid5/nfs, доступ для чтения и записи для всей сети в сторону HQ-CLI

- На HQ-CLI настройте автомонтирование в папку /mnt/nfs

- Основные параметры сервера отметьте в отчете

<br/>

<details>
<summary>Решение</summary>
<br/>

#### Создание RAID

Просматриваем имена добавленных дисков:
```yml
lsblk
```
> Вывод:
> ```yml
> sdb  8:16  0  1G  0  disk
> sdc  8:32  0  1G  0  disk
> sdd  8:48  0  1G  0  disk
> ```

<br/>

Обнуляем суперблоки для добавленных дисков:
```yml
mdadm --zero-superblock --force /dev/sd{b,c,d}
```
> Вывод:
> ```yml
> mdadm: Unrecongised md component device - /dev/sdx
> ```
> > Гласит о том, что диски не использовались ранее для **RAID**

<br/>

Удаляем старые метаданные и подпись на дисках:
```yml
wipefs --all --force /dev/sd{b,c,d}
```

<br/>

Создаем **RAID**:
```yml
mdadm --create /dev/md0 -l 5 -n 3 /dev/sd{b,c,d}
```
> **/dev/md0** - название RAID после сборки
>
> **-l 5** - уровень RAID
>
> **-n 3** - количество дисков, из которых собирается массив
>
> **/dev/sd{b,c,d}** - диски, из которых выполняется сборка

<br/>

Проверяем:
```yml
lsblk
```
> Вывод:
> ```yml
> sdb  8:16  0  1G  0  disk
>   md0  9:0  0  2G  0  raid5
> sdc  8:32  0  1G  0  disk
>   md0  9:0  0  2G  0  raid5
> sdd  8:48  0  1G  0  disk
>   md0  9:0  0  2G  0  raid5
> ```

<br/>

Создаем файловую систему из созданного **RAID**:
```yml
mkfs -t ext4 /dev/md0
```

<br/>

#### Создание файла `mdadm.conf`

Создаем директорию для файла:
```yml
mkdir /etc/mdadm
```

<br/>

Заполняем файл информацией:
```yml
echo "DEVICE partitions" > /etc/mdadm/mdadm.conf
mdadm --detail --scan | awk '/ARRAY/ {print}' >> /etc/mdadm/mdadm.conf
```

<br/>

#### Создание файловой системы и монтирование RAID-массива

Создаем директорию для монтирования массива:
```yml
mkdir /mnt/raid5
```

<br/>

Добавляем строку в **`/etc/fstab`**:
```yml
/dev/md0  /mnt/raid5  ext4  defaults  0  0
```

<br/>

Монтируем:
```yml
mount -a
```

<br/>

Проверяем монтирование:
```yml
df -h
```
> Вывод:
> ```yml
> /dev/md0  2.0G  24K  1.9G  1%  /mnt/raid5
> ```

<br/>

#### Настройка NFS

Устанавливаем пакеты для **NFS-сервера**:
```yml
apt-get install -y nfs-{server,utils}
```

<br/>

Создаем директорию для общего доступа:
```yml
mkdir /mnt/raid5/nfs
```

<br/>

Выдаем права на чтение и запись этой директории:
```yml
chmod 766 /mnt/raid5/nfs
```

<br/>

Добавляем строку в **`/etc/exports`**:
```yml
/mnt/raid5/nfs 192.168.200.0/28(rw,no_root_squash)
```
> **/mnt/raid5/nfs** - общий ресурс
>
> **192.168.200.0/28** - клиентская сеть, которой разрешено монтирование общего ресурса
>
> **rw** — разрешены чтение и запись
>
> **no_root_squash** — отключение ограничения прав **root**

<br/>

Экспортируем файловую систему, которую прописали ранее:
```yml
exportfs -arv
```
> **-a** - экспортировать все указанные каталоги
>
> **-r** - повторный экспорт всех каталогов, синхронизируя **/var/lib/nfs/etab** с **/etc/exports** и файлами в **/etc/exports.d**
>
> **-v** - подробный вывод

<br/>

Запускаем и добавляем в автозагрузку **NFS-сервер**:
```yml
systemctl enable --now nfs-server
```

<br/>

#### Настройка клиента

Устанавливаем требуемые пакеты для **NFS-клиента**:
```yml
apt-get update && apt-get install -y nfs-{utils,clients}
```

<br/>

Создаем директорию для общего ресурса:
```yml
mkdir /mnt/nfs
```

<br/>

Выдаем права этой директории:
```yml
chmod 777 /mnt/nfs
```

<br/>

Добавляем строку в **`/etc/fstab`** для автоматического монтирования общего ресурса:
```yml
192.168.100.62:/mnt/raid5/nfs  /mnt/nfs  nfs  defaults  0  0
```

<br/>

Монтируем общий ресурс:
```yml
mount -a
```

<br/>

Проверяем монтирование:
```yml
df -h
```
> Вывод:
> ```yml
> 192.168.100.62:/mnt/raid5/nfs  2,0G  0  1,9G  0%  /mnt/nfs
> ```
</details>

<br/>
